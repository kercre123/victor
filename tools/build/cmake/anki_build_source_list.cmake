
macro(anki_build_source_list target_name srclist_dir)

set(SRC_LIST_FILE "${srclist_dir}/${target_name}.srcs.lst")
set(HDR_LIST_FILE "${srclist_dir}/${target_name}.headers.lst")

if (EXISTS ${SRC_LIST_FILE})
  file(STRINGS ${SRC_LIST_FILE} SRCS)
else()
  message(FATAL_ERROR ${SRC_LIST_FILE} " not found. Did you forget to add your BUILD.in to build-victor.sh?")
endif()

set(HEADERS "")
if (EXISTS ${HDR_LIST_FILE})
  file(STRINGS ${HDR_LIST_FILE} HEADERS)
endif()

set(_ab_PLATFORM_SRCS "")
set(_ab_PLATFORM_HEADERS "")
set(_ab_GO_DIR "")
if (ANDROID)
  if (EXISTS "${srclist_dir}/${target_name}_android.srcs.lst")
    file(STRINGS "${srclist_dir}/${target_name}_android.srcs.lst" _ab_PLATFORM_SRCS)
  endif()
  if (EXISTS "${srclist_dir}/${target_name}_android.headers.lst")
    file(STRINGS "${srclist_dir}/${target_name}_android.headers.lst" _ab_PLATFORM_HEADERS)
  endif()
elseif (VICOS)
  if (EXISTS "${srclist_dir}/${target_name}_vicos.srcs.lst")
    file(STRINGS "${srclist_dir}/${target_name}_vicos.srcs.lst" _ab_PLATFORM_SRCS)
  endif()
  if (EXISTS "${srclist_dir}/${target_name}_vicos.headers.lst")
    file(STRINGS "${srclist_dir}/${target_name}_vicos.headers.lst" _ab_PLATFORM_HEADERS)
  endif()
elseif (MACOSX)
  if (EXISTS "${srclist_dir}/${target_name}_mac.srcs.lst")
    file(STRINGS "${srclist_dir}/${target_name}_mac.srcs.lst" _ab_PLATFORM_SRCS)
  endif()
  if (EXISTS "${srclist_dir}/${target_name}_mac.headers.lst")
    file(STRINGS "${srclist_dir}/${target_name}_mac.headers.lst" _ab_PLATFORM_HEADERS)
  endif()
endif()
if (EXISTS "${srclist_dir}/${target_name}.godir.lst")
  file(STRINGS "${srclist_dir}/${target_name}.godir.lst" _ab_GO_DIR)
endif()

endmacro()

macro(anki_build_absolute_source_list target_name srclist_dir)
  anki_build_source_list(${target_name} ${srclist_dir})
  # transform source files into absolute paths
  set(__temp_srclist "")
  foreach(i ${SRCS})
    set(__temp_srci "${CMAKE_CURRENT_SOURCE_DIR}/${i}")
  list(APPEND __temp_srclist ${__temp_srci})
  endforeach(i)
  set(SRCS ${__temp_srclist})
endmacro()
